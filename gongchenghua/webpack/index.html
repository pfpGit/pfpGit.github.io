<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack核心插件Tapable源码解析 | 前端技术集锦</title>
    <meta name="description" content="html新特性，css3，javascript，es6，vue，flutter，移动端开发采坑！！">
    <meta name="generator" content="VuePress 1.3.1">
    <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.ba29e539.css" as="style"><link rel="preload" href="/assets/js/app.1f197e59.js" as="script"><link rel="preload" href="/assets/js/2.1002a903.js" as="script"><link rel="preload" href="/assets/js/5.ec7052b1.js" as="script"><link rel="prefetch" href="/assets/js/10.c65d6c64.js"><link rel="prefetch" href="/assets/js/11.edf3ffe3.js"><link rel="prefetch" href="/assets/js/12.d8d02c41.js"><link rel="prefetch" href="/assets/js/13.b7a1f78b.js"><link rel="prefetch" href="/assets/js/14.9f896c49.js"><link rel="prefetch" href="/assets/js/15.e4cd454a.js"><link rel="prefetch" href="/assets/js/16.eaa6d869.js"><link rel="prefetch" href="/assets/js/17.ae3bd1da.js"><link rel="prefetch" href="/assets/js/18.8e7d58ae.js"><link rel="prefetch" href="/assets/js/19.6c09fe8f.js"><link rel="prefetch" href="/assets/js/20.0f84e775.js"><link rel="prefetch" href="/assets/js/21.3cf1df8c.js"><link rel="prefetch" href="/assets/js/22.b1a220a3.js"><link rel="prefetch" href="/assets/js/23.69a79d11.js"><link rel="prefetch" href="/assets/js/24.f3b37552.js"><link rel="prefetch" href="/assets/js/25.92657d6b.js"><link rel="prefetch" href="/assets/js/26.903d48d4.js"><link rel="prefetch" href="/assets/js/27.b34ff39f.js"><link rel="prefetch" href="/assets/js/28.9e288393.js"><link rel="prefetch" href="/assets/js/3.7ab5aa59.js"><link rel="prefetch" href="/assets/js/4.7f5a8fde.js"><link rel="prefetch" href="/assets/js/6.98e520c9.js"><link rel="prefetch" href="/assets/js/7.e1a55996.js"><link rel="prefetch" href="/assets/js/8.020d1f0e.js"><link rel="prefetch" href="/assets/js/9.2eab56cd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ba29e539.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端技术集锦</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/front-end/" class="nav-link">
  前端技术集锦
</a></div><div class="nav-item"><a href="/gongchenghua/" class="nav-link router-link-active">
  工程化
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试集锦
</a></div><div class="nav-item"><a href="/sourceCode/" class="nav-link">
  源码
</a></div><div class="nav-item"><a href="/mobile/" class="nav-link">
  移动开发
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/front-end/" class="nav-link">
  前端技术集锦
</a></div><div class="nav-item"><a href="/gongchenghua/" class="nav-link router-link-active">
  工程化
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试集锦
</a></div><div class="nav-item"><a href="/sourceCode/" class="nav-link">
  源码
</a></div><div class="nav-item"><a href="/mobile/" class="nav-link">
  移动开发
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/gongchenghua/" class="sidebar-link">Introduction</a></li><li><a href="/gongchenghua/webpack/" class="active sidebar-link">webpack核心插件Tapable源码解析</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/gongchenghua/xingnengyouhua/" class="sidebar-link">性能优化</a></li><li><a href="/gongchenghua/ci/" class="sidebar-link">持续集成</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack核心插件tapable源码解析"><a href="#webpack核心插件tapable源码解析" class="header-anchor">#</a> webpack核心插件Tapable源码解析</h1> <p>完成webpack默认参数注入后，下一步虽然是 new Compiler() ，但是这东西不是一下可以讲完的，复杂的一批。
不如先从工具入手，分块讲解compiler，首先来看看事件流执行器Tapable工具。</p> <blockquote><p>tips：这里的Tapable源码来自于webpack内部自带的tapable，如果通过npm i tapable查看会发现完全不一样。</p></blockquote> <p>出现地点如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token keyword">extends</span> <span class="token class-name">Tapable</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Compilation</span> <span class="token keyword">extends</span> <span class="token class-name">Tapable</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...  </span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>可以看到核心对象基本上都继承于该工具，用于处理事件流，Tapable源码整理如下(用ES6的class复写了一遍，看起来比较清晰)：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 原型方法混入</span>
Tapable<span class="token punctuation">.</span><span class="token function-variable function">mixin</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">mixinTapable</span><span class="token punctuation">(</span><span class="token parameter">pt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/**/</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">copyProperties</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">from</span><span class="token punctuation">,</span> to</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/**/</span> <span class="token punctuation">}</span>

<span class="token comment">// 服务于某些apply</span>
<span class="token keyword">function</span> <span class="token function">fastFilter</span><span class="token punctuation">(</span>fun <span class="token comment">/*, thisArg*/</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Tapable</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">plugin</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">hasPlugins</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPlugins</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPlugins0</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPlugins1</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPlugins2</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> param1<span class="token punctuation">,</span> param2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsWaterfall</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> init</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsWaterfall0</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> init</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsWaterfall1</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> init<span class="token punctuation">,</span> param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsWaterfall2</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> init<span class="token punctuation">,</span> param1<span class="token punctuation">,</span> param2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsBailResult</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsBailResult1</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsBailResult2</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> param1<span class="token punctuation">,</span> param2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsBailResult3</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> param1<span class="token punctuation">,</span> param2<span class="token punctuation">,</span> param3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsBailResult4</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> param1<span class="token punctuation">,</span> param2<span class="token punctuation">,</span> param3<span class="token punctuation">,</span> param4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsBailResult5</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> param1<span class="token punctuation">,</span> param2<span class="token punctuation">,</span> param3<span class="token punctuation">,</span> param4<span class="token punctuation">,</span> param5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsAsyncSeries</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsAsyncSeries1</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> param<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsAsyncSeriesBailResult</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsAsyncSeriesBailResult1</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> param<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsAsyncWaterfall</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> init<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsParallel</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsParallelBailResult</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token function">applyPluginsParallelBailResult1</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> param<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Tapable<span class="token punctuation">;</span>
</code></pre></div><blockquote><p>构造函数只是简单的声明了一个_plugins对象，外部函数包括有一个混入函数、一个工具函数，原型上则是大量apply...，先从简单的入手，看看混入函数：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 将Tapable原型方法复制到指定对象中</span>
<span class="token keyword">function</span> <span class="token function">copyProperties</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">from</span><span class="token punctuation">,</span> to</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> <span class="token keyword">from</span><span class="token punctuation">)</span>
        to<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">from</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> to<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 传入对象</span>
Tapable<span class="token punctuation">.</span><span class="token function-variable function">mixin</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">mixinTapable</span><span class="token punctuation">(</span><span class="token parameter">pt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">copyProperties</span><span class="token punctuation">(</span><span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>非常简单，用一个小案例说明：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> Tapable <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./Tapable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> sourObj <span class="token operator">=</span> <span class="token punctuation">{</span> ownKey<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
Tapable<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span>sourObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>通过mixin方法的调用，sourObj会变成：</p></blockquote> <p><img src="data:image/png;base64,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" alt=" "></p> <blockquote><p>至于另外一个工具函数，单独讲没有任何意义，所以在用到的时候再做分析。接下来分析原型函数，其中有两个函数是基本操作函数，其余的都是用不同方式执行指定名字的事件流。</p></blockquote> <p>先看基本的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 基本操作函数plugin</span>
<span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">plugin</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">plugin</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将函数注入多个事件流中</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 如果不存在该事件流 新建并将函数插入</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>fn<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 存在就添加执行函数</span>
    <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>这是Tapable最基本的操作，给指定的事件流注入新函数。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// hasPlugins</span>

<span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">hasPlugins</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">hasPlugins</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 尝试获取对应事件流</span>
    <span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 存在事件流且有可执行函数</span>
    <span class="token keyword">return</span> plugins <span class="token operator">&amp;&amp;</span> plugins<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// has判断，没啥好讲的。</span>
</code></pre></div><h3 id="事件流执行"><a href="#事件流执行" class="header-anchor">#</a> 事件流执行</h3> <blockquote><p>接下来看看所有的事件流执行方式。(源码中尽量使用ES6进行改写以增强可读性，留个注释在那)</p></blockquote> <p>首先是一个比较特殊的原型函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// apply</span>

<span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">apply</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>fns</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 遍历所有参数并执行</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> fns<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 该函数并不直接关联于_plugins对象，而是按照参数传入顺序依次执行。</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// applyPlugins</span>
<span class="token comment">// 这个方式非常简单暴力，依次遍历指定name的事件流，不同名字的函数可接受参数数量不一样。</span>

<span class="token comment">// 不接受传参</span>
<span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPlugins0</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPlugins0</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>plugins<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 接受一个参数</span>
<span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPlugins1</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPlugins1</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>plugins<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 接受两个参数</span>
<span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPlugins2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPlugins2</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> param1<span class="token punctuation">,</span> param2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>plugins<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> param1<span class="token punctuation">,</span> param2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 接受任意数量参数</span>
<span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPlugins</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPlugins</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token comment">// var args = Array.prototype.slice.call(arguments, 1);</span>
    <span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>语义化满分，0代表不接受参数，1代表1个...而s代表任意数量的参数。</p></blockquote> <h3 id="applypluginswaterfall"><a href="#applypluginswaterfall" class="header-anchor">#</a> applyPluginsWaterfall</h3> <blockquote><p>这种方式的特点是：事件流执行过程中，每一次执行的返回值会作为下一次的参数(仅限于第一个参数)。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPluginsWaterfall0</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPluginsWaterfall0</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> init</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>plugins<span class="token punctuation">)</span> <span class="token keyword">return</span> init<span class="token punctuation">;</span>
    <span class="token keyword">var</span> current <span class="token operator">=</span> init<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        current <span class="token operator">=</span> plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> current<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ...1</span>
<span class="token comment">// ...2</span>

<span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPluginsWaterfall</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPluginsWaterfall</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> init<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> init<span class="token punctuation">;</span>
    <span class="token comment">// var args = Array.prototype.slice.call(arguments, 1);</span>
    <span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> current <span class="token operator">=</span> init<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        current <span class="token operator">=</span> plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> current<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> current<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>applyPluginsBailResult</p> <blockquote><p>这种方式的特点是：事件流执行过程中，返回第一个不是undefined的值，后续函数不执行。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPluginsBailResult</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPluginsBailResult</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token comment">// var args = Array.prototype.slice.call(arguments, 1);</span>
    <span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> result <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 1,2,3,4,5</span>
</code></pre></div><p>applyPluginsAsync...</p> <blockquote><p>带有Async的均为异步调用方式，特点是事件流会在回调中依次进行，区别主要在于回调函数的参数处理，具体的使用方式还需要在实际应用中来看。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>applyPluginsAsyncSeries <span class="token operator">=</span> <span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPluginsAsync</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPluginsAsyncSeries</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// var args = Array.prototype.slice.call(arguments, 1);</span>
    <span class="token comment">// 最后一个参数为回调函数 其余为普通参数</span>
    <span class="token keyword">var</span> callback <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>plugins <span class="token operator">||</span> plugins<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">// var _this = this;</span>
    <span class="token comment">// 包装</span>
    args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 内部继续使用此方式可依次执行事件流</span>
    plugins<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ..1</span>

<span class="token comment">// applyPluginsAsyncSeriesBailResult =&gt; 回调函数传了参数就直接执行回调并返回终止事件流</span>

<span class="token comment">// ..1</span>

<span class="token comment">// applyPluginsAsyncWaterfall =&gt; 回调函数每次取给定的参数</span>
</code></pre></div><p>剩下的3个比较复杂，干讲也不知道怎么解释，等到后面的代码有用到的时候再组具体分析。</p> <p>...</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/gongchenghua/" class="prev router-link-active">
        Introduction
      </a></span> <span class="next"><a href="/gongchenghua/xingnengyouhua/">
        性能优化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1f197e59.js" defer></script><script src="/assets/js/2.1002a903.js" defer></script><script src="/assets/js/5.ec7052b1.js" defer></script>
  </body>
</html>
